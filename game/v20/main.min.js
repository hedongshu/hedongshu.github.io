var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),OverScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="OverSceneSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.init,t),t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.init=function(){this.btn_restart.addEventListener(egret.TouchEvent.TOUCH_TAP,this.restart,this)},t.prototype.restart=function(){SceneController.show_gameScene()},t.prototype.setScroce=function(e){this.lab_score.text=e},t}(eui.Component);__reflect(OverScene.prototype,"OverScene",["eui.UIComponent","egret.DisplayObject"]);var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function i(i){t.call(n,i,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?i(r):RES.getResAsync(e,i,this)}else RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isThemeLoadEnd=!1,t.isResourceLoadEnd=!1,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("loadUI",1),RES.loadGroup("preload",0)},t.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},t.prototype.onResourceLoadComplete=function(e){"loadUI"==e.groupName&&(this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView)),"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},t.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.startCreateScene=function(){var e=new egret.DisplayObjectContainer;this.addChild(e),SceneController.instance.setStage(e),SceneController.initGame()},t.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t},t.hitTest=function(e,t){var n=e.getBounds(),i=t.getBounds();return n.x=e.x,n.y=e.y,i.x=t.x,i.y=t.y,n.intersects(i)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,i){function r(e){t.call(i,e)}function s(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),n.call(i))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var GameScene=function(e){function t(){var t=e.call(this)||this;return t.countTime=0,t.score_num=0,t.myBullets=[],t.enemyBullets=[],t.speed=5,t.skinName="GameSceneSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.onAddToStage=function(){this.createMyPlane(),this.myPlane.addEventListener("createBullet",this.createBullet,this),this.addEventListener(egret.Event.ENTER_FRAME,this.update,this),this.tickTime=egret.getTimer(),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.moveMyPlane,this,!0),this.createEnemy_timer=new egret.Timer(1e3),this.createEnemy_timer.addEventListener(egret.TimerEvent.TIMER,this.createEnemy,this),this.createEnemy_timer.start()},t.prototype.update=function(e){if(this.blood.width=20*this.myPlane.blood,this.score.text=this.score_num.toString(),this.bg1.height-this.bg1.y<=0&&(this.bg1.y=this.bg2.y-this.bg1.height),this.bg2.height-this.bg2.y<=0&&(this.bg2.y=this.bg1.y-this.bg2.height),this.bg1.y+=2,this.bg2.y+=2,this.group_enemyPlanes.numChildren>0)for(var t=this.group_enemyPlanes.numChildren-1;t>=0;t--){var n=this.group_enemyPlanes.getChildAt(t);n.y>=this.height&&(n.isDie||(n.isDie=!0,Plane.reclaim(n),n.removeEventListener("createBullet",this.createBullet,this),n.stopFire(),this.group_enemyPlanes.removeChild(n))),n.y+=4}for(var i=this.myBullets.length,t=0;i>t;t++){var r=this.myBullets[t];r.y<=0&&(r.isDelete||(r.isDelete=!0,this.removeChild(r),Bullet.reclaim(r),this.myBullets.splice(t,1),t--,i--)),r.y-=12}for(var s=this.enemyBullets.length,t=0;s>t;t++){var r=this.enemyBullets[t];r.y>=this.height&&(r.isDelete||(r.isDelete=!0,this.removeChild(r),Bullet.reclaim(r),this.enemyBullets.splice(t,1),t--,s--)),r.y+=8}return this.group_enemyPlanes.numChildren>0&&this.myBullets.length>0&&this.enemyBullets.length>0&&this.testHit(),!1},t.prototype.testHit=function(){for(var e=[],t=[],n=0;n<this.myBullets.length;n++)for(var i=this.myBullets[n],r=this.group_enemyPlanes.numChildren-1;r>=0;r--){var s=this.group_enemyPlanes.getChildAt(r);Main.hitTest(i,s)&&(s.blood-=1,-1==e.indexOf(i)&&e.push(i),s.blood<=0&&-1==t.indexOf(s)&&(s.die(),t.push(s)))}for(var n=0;n<this.enemyBullets.length;n++){var i=this.enemyBullets[n];Main.hitTest(i,this.myPlane)&&(this.myPlane.blood--,-1==e.indexOf(i)&&e.push(i))}for(var n=this.group_enemyPlanes.numChildren-1;n>=0;n--){var s=this.group_enemyPlanes.getChildAt(n);if(Main.hitTest(s,this.myPlane))return void this.gameOver()}if(this.myPlane.blood<=0)return void this.gameOver();for(var o=0,a=e;o<a.length;o++){var l=a[o];e.splice(e.indexOf(l),1),this.removeChild(l),0==l.type?this.myBullets.splice(this.myBullets.indexOf(l),1):this.enemyBullets.splice(this.enemyBullets.indexOf(l),1),Bullet.reclaim(l)}for(var h=0,c=t;h<c.length;h++){var l=c[h];this.score_num+=3==l.type?4:l.type,t.splice(t.indexOf(l),1),l.stopFire(),l.removeEventListener("createBullet",this.createBullet,this),this.group_enemyPlanes.removeChild(l),Plane.reclaim(l)}},t.prototype.gameOver=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.update,this),SceneController.show_OverScene(this.score.text)},t.prototype.createMyPlane=function(){this.myPlane=new Plane(0,200),this.addChild(this.myPlane),this.myPlane.blood=10,this.myPlane.x=(this.width-this.myPlane.getChildAt(0).width)/2,this.myPlane.y=this.height-this.myPlane.getChildAt(0).height-50,this.myPlane.startFire()},t.prototype.createEnemy=function(){var e=Math.floor(3*Math.random())+1,t=Plane.produce(e,1e3);switch(t.x=Math.random()*(this.width-t.getChildAt(0).width),t.y=-t.getChildAt(0).height,t.addEventListener("createBullet",this.createBullet,this),t.startFire(),t.type){case 1:t.blood=1;break;case 2:t.blood=4;break;case 3:t.blood=6}this.group_enemyPlanes.addChild(t)},t.prototype.moveMyPlane=function(e){if(e.type==egret.TouchEvent.TOUCH_MOVE){var t=e.stageX;t=Math.max(0,t),t=Math.min(this.stage.stageWidth-this.myPlane.width,t),this.myPlane.x=t}},t.prototype.createBullet=function(e){var t;if(e.target==this.myPlane)for(var n=0;2>n;n++)t=Bullet.produce(0),t.x=0==n?this.myPlane.x+18:this.myPlane.x+this.myPlane.width-18,t.y=this.myPlane.y+20,this.addChild(t),this.myBullets.push(t);else{var i=e.target;t=Bullet.produce(1),t.x=i.x+i.width/2,t.y=i.y+i.height+20,this.addChild(t),this.enemyBullets.push(t)}},t}(eui.Component);__reflect(GameScene.prototype,"GameScene",["eui.UIComponent","egret.DisplayObject"]);var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.createView,t),t}return __extends(t,e),t.prototype.createView=function(){this.img=new eui.Image,this.img.source=RES.getRes("背景1_画板 1_png"),this.addChild(this.img),this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=(this.stage.stageHeight-this.textField.height)/2,this.textField.width=this.stage.stageWidth,this.textField.height=100,this.textField.textAlign="center"},t.prototype.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var SceneController=function(){function e(){this.StartScene=new StartScene,this.TipScene=new TipScene,this.GameScene=new GameScene,this.OverScene=new OverScene}return Object.defineProperty(e,"instance",{get:function(){return this.sceneController||(this.sceneController=new e),this.sceneController},enumerable:!0,configurable:!0}),e.prototype.setStage=function(e){this._stage=e},e.initGame=function(){var e=this.instance._stage;e.addChild(this.instance.StartScene)},e.show_tipScene=function(){var e=this.instance._stage;this.instance.StartScene.parent&&e.removeChild(this.instance.StartScene),e.addChild(this.instance.TipScene)},e.show_gameScene=function(){var e=this.instance._stage;this.instance.TipScene.parent?(e.removeChild(this.instance.TipScene),this.instance.GameScene=new GameScene):this.instance.OverScene.parent&&(e.removeChild(this.instance.OverScene),this.instance.GameScene=new GameScene),e.addChild(this.instance.GameScene)},e.show_OverScene=function(e){var t=this.instance._stage;this.instance.GameScene.parent&&t.removeChild(this.instance.GameScene),t.addChild(this.instance.OverScene),this.instance.OverScene.setScroce(e)},e}();__reflect(SceneController.prototype,"SceneController");var StartScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="StartSceneSkin",t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.btn_start.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SceneController.show_tipScene()},this),this.btn_rule.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("规则")},this)},t}(eui.Component);__reflect(StartScene.prototype,"StartScene",["eui.UIComponent","egret.DisplayObject"]);var TipScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="TipSceneSkin",t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SceneController.show_gameScene()},this)},t}(eui.Component);__reflect(TipScene.prototype,"TipScene",["eui.UIComponent","egret.DisplayObject"]);var bulletType;!function(e){e[e.my=0]="my",e[e.enemy=1]="enemy"}(bulletType||(bulletType={}));var Bullet=function(e){function t(t){var n=e.call(this)||this;return n.isDelete=!1,n.type=t,n.radius=10,n.color=0==n.type?14181959:0,n.graphics.beginFill(n.color),n.graphics.drawCircle(0,0,n.radius),n.graphics.endFill(),n}return __extends(t,e),t.produce=function(e){null==this._pool[e]&&(this._pool[e]=[]);var n,i=this._pool[e];return i.length>0?(n=i.pop(),n.isDelete=!1):n=new t(e),n},t.reclaim=function(e){null==this._pool[e.type]&&(this._pool[e.type]=[]);var t=this._pool[e.type];-1==t.indexOf(e)&&t.push(e)},t._pool={},t}(egret.Shape);__reflect(Bullet.prototype,"Bullet");var planeType;!function(e){e[e.myPlane=0]="myPlane",e[e.plane_s=1]="plane_s",e[e.plane_m=2]="plane_m",e[e.plane_l=3]="plane_l"}(planeType||(planeType={}));var Plane=function(e){function t(t,n){var i=e.call(this)||this;return i.isDie=!1,i.type=t,i.time=n,i.Timer=new egret.Timer(i.time),i.Timer.addEventListener(egret.TimerEvent.TIMER,i.createBullet,i),i}return __extends(t,e),t.produce=function(e,n){null==t._pool[e]&&(t._pool[e]=[]);var i,r=t._pool[e];return r.length>0?(i=r.pop(),i.isDie=!1,i.bmp.source=RES.getRes("plane"+i.type+"_png")):i=new t(e,n),i},t.reclaim=function(e){null==t._pool[e.type]&&(t._pool[e.type]=[]);var n=t._pool[e.type];-1==n.indexOf(e)&&n.push(e)},Object.defineProperty(t.prototype,"type",{get:function(){return this._type},set:function(e){this._type=e,this.bmp=new eui.Image,this.bmp.source=RES.getRes("plane"+e+"_png"),this.addChild(this.bmp)},enumerable:!0,configurable:!0}),t.prototype.startFire=function(){this.Timer.start()},t.prototype.stopFire=function(){this.Timer.stop()},t.prototype.createBullet=function(){this.dispatchEventWith("createBullet")},t.prototype.die=function(){var e=this.getChildAt(0);e.source=RES.getRes("plane"+this.type+"_d_png")},t._pool={},t}(egret.DisplayObjectContainer);__reflect(Plane.prototype,"Plane");